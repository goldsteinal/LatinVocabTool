<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latin Vocabulary Trainer</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-color: #6366f1;
            --secondary-color: #ec4899;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --border-color: #334155;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .background-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInUp 1s ease-out;
        }

        .title {
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            font-weight: 300;
            margin-bottom: 0.5rem;
        }

        .version {
            font-size: 0.875rem;
            color: var(--text-secondary);
            opacity: 0.7;
        }

        /* Home Screen - 3 Buttons */
        .home-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            animation: fadeIn 1s ease-out;
        }

        .main-buttons {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            width: 100%;
            max-width: 400px;
        }

        .main-btn {
            padding: 1.5rem 2rem;
            border: none;
            border-radius: 16px;
            font-size: 1.25rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .main-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .main-btn:hover::before {
            left: 100%;
        }

        .main-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .main-btn:active {
            transform: translateY(-2px);
        }

        .btn-add {
            background: var(--gradient-1);
            color: white;
        }

        .btn-study {
            background: var(--gradient-2);
            color: white;
        }

        .btn-manage {
            background: var(--gradient-3);
            color: white;
        }

        .btn-icon {
            font-size: 1.5rem;
        }

        .back-btn {
            position: fixed;
            top: 2rem;
            left: 2rem;
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            display: none;
            align-items: center;
            gap: 0.5rem;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-2px);
        }

        .back-btn.visible {
            display: flex;
        }

        /* Section Styles */
        .section {
            display: none;
            animation: fadeInUp 0.5s ease-out;
            flex: 1;
            padding-top: 2rem;
        }

        .section.active {
            display: block;
        }

        .section-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--primary-color);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
        }

        .btn.secondary {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
        }

        .btn.danger {
            background: var(--danger-color);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .hidden {
            display: none !important;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .title {
                font-size: 2.5rem;
            }

            .main-buttons {
                max-width: 300px;
            }

            .main-btn {
                padding: 1.25rem 1.5rem;
                font-size: 1.125rem;
            }

            .back-btn {
                top: 1rem;
                left: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="background-pattern"></div>
    
    <div class="container">
        <!-- Back Button -->
        <a href="#" class="back-btn" id="backBtn" onclick="showHome()">
            <span>←</span> Back to Home
        </a>

        <!-- Header -->
        <div class="header">
            <h1 class="title">Latin Vocabulary</h1>
            <p class="subtitle">Master Latin with Smart Learning</p>
            <div class="version">Version 2.0</div>
        </div>
        
        <!-- Home Screen -->
        <div id="home" class="home-screen">
            <div class="main-buttons">
                <button class="main-btn btn-add" onclick="showAddWords()">
                    <span class="btn-icon">➕</span>
                    Add Words
                </button>
                
                <button class="main-btn btn-study" onclick="showStudy()">
                    <span class="btn-icon">🎓</span>
                    Study
                </button>
                
                <button class="main-btn btn-manage" onclick="showManageWords()">
                    <span class="btn-icon">⚙️</span>
                    Manage Words
                </button>
            </div>
        </div>
        
        <!-- Content area where other modules will inject their UI -->
        <div id="contentArea"></div>
    </div>

    <!-- Load all JavaScript modules -->
    <script src="data-manager.js"></script>
    <script src="spaced-repetition.js"></script>
    <script src="add-words.js"></script>
    <script src="study.js"></script>
    <script src="manage-words.js"></script>
    <script>
        // Main application initialization
        let currentSection = 'home';

        // Show home screen
        function showHome() {
            // Hide content area
            document.getElementById('contentArea').innerHTML = '';
            document.getElementById('contentArea').style.display = 'none';
            
            // Show home screen
            document.getElementById('home').style.display = 'flex';
            document.getElementById('backBtn').classList.remove('visible');
            currentSection = 'home';
        }

        // Functions to call external modules
        function showAddWords() {
            // Hide home screen
            document.getElementById('home').style.display = 'none';
            document.getElementById('contentArea').style.display = 'block';
            document.getElementById('backBtn').classList.add('visible');
            
            // Call function from add-words.js
            if (typeof initializeAddWords === 'function') {
                initializeAddWords();
            } else {
                console.error('Add words module not loaded');
            }
            currentSection = 'add';
        }

        function showStudy() {
            // Hide home screen
            document.getElementById('home').style.display = 'none';
            document.getElementById('contentArea').style.display = 'block';
            document.getElementById('backBtn').classList.add('visible');
            
            // Call function from study.js
            if (typeof initializeStudy === 'function') {
                initializeStudy();
            } else {
                console.error('Study module not loaded');
            }
            currentSection = 'study';
        }

        function showManageWords() {
            // Hide home screen
            document.getElementById('home').style.display = 'none';
            document.getElementById('contentArea').style.display = 'block';
            document.getElementById('backBtn').classList.add('visible');
            
            // Call function from manage-words.js
            if (typeof initializeManageWords === 'function') {
                initializeManageWords();
            } else {
                console.error('Manage words module not loaded');
            }
            currentSection = 'manage';
        }

// add-words.js - Add Words Module for Latin Vocabulary Trainer

function initializeAddWords() {
    const contentArea = document.getElementById('contentArea');
    
    // Create the Add Words interface HTML
    const addWordsHTML = `
        <div class="section active">
            <div class="section-header">
                <h2 class="section-title">Add New Words</h2>
                <p style="color: var(--text-secondary); font-size: 1.1rem; margin-bottom: 0;">
                    Expand your Latin vocabulary by adding new words and their meanings
                </p>
            </div>
            
            <!-- Statistics Cards -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalWordsCount">0</div>
                    <div class="stat-label">Total Words</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="recentlyAddedCount">0</div>
                    <div class="stat-label">Added Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="averageScore">0%</div>
                    <div class="stat-label">Avg. Mastery</div>
                </div>
            </div>

            <!-- Add Word Form -->
            <div class="card" style="max-width: 600px; margin: 0 auto;">
                <h3 style="color: var(--text-primary); margin-bottom: 1.5rem; font-size: 1.5rem; font-weight: 600;">
                    Add New Word
                </h3>
                
                <form id="addWordForm">
                    <div class="form-group">
                        <label for="latinWord">Latin Word</label>
                        <input 
                            type="text" 
                            id="latinWord" 
                            name="latinWord" 
                            class="form-input" 
                            placeholder="e.g., amor, virtus, sapientia..."
                            required
                            autocomplete="off"
                        >
                        <small style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.25rem; display: block;">
                            Enter the Latin word you want to learn
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="englishMeaning">English Meaning</label>
                        <input 
                            type="text" 
                            id="englishMeaning" 
                            name="englishMeaning" 
                            class="form-input" 
                            placeholder="e.g., love, virtue, wisdom..."
                            required
                            autocomplete="off"
                        >
                        <small style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.25rem; display: block;">
                            Enter the English translation or meaning
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="wordType">Word Type (Optional)</label>
                        <select id="wordType" name="wordType" class="form-input">
                            <option value="">Select type...</option>
                            <option value="noun">Noun</option>
                            <option value="verb">Verb</option>
                            <option value="adjective">Adjective</option>
                            <option value="adverb">Adverb</option>
                            <option value="preposition">Preposition</option>
                            <option value="conjunction">Conjunction</option>
                            <option value="interjection">Interjection</option>
                            <option value="phrase">Phrase</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
                        <button type="submit" class="btn" style="min-width: 140px;">
                            ➕ Add Word
                        </button>
                        <button type="button" class="btn secondary" onclick="clearAddWordForm()" style="min-width: 140px;">
                            🗑️ Clear
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Recent Additions -->
            <div class="card" style="margin-top: 2rem; max-width: 800px; margin-left: auto; margin-right: auto;">
                <h3 style="color: var(--text-primary); margin-bottom: 1.5rem; font-size: 1.5rem; font-weight: 600;">
                    Recently Added Words
                </h3>
                <div id="recentWordsList" style="min-height: 100px;">
                    <!-- Recent words will be populated here -->
                </div>
            </div>
            
            <!-- Success/Error Messages -->
            <div id="messageContainer" style="position: fixed; top: 100px; right: 2rem; z-index: 1000;"></div>
        </div>
    `;
    
    // Inject the HTML
    contentArea.innerHTML = addWordsHTML;
    
    // Initialize the form and load data
    initializeAddWordForm();
    updateStats();
    loadRecentWords();
}

function initializeAddWordForm() {
    const form = document.getElementById('addWordForm');
    
    if (form) {
        form.addEventListener('submit', handleAddWord);
        
        // Add input validation and formatting
        const latinInput = document.getElementById('latinWord');
        const englishInput = document.getElementById('englishMeaning');
        
        // Auto-focus on Latin word input
        latinInput.focus();
        
        // Add real-time validation
        latinInput.addEventListener('input', validateLatinInput);
        englishInput.addEventListener('input', validateEnglishInput);
        
        // Enter key handling for better UX
        latinInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                englishInput.focus();
            }
        });
    }
}

function handleAddWord(event) {
    event.preventDefault();
    
    const form = event.target;
    const formData = new FormData(form);
    
    const latinWord = formData.get('latinWord').trim();
    const englishMeaning = formData.get('englishMeaning').trim();
    const wordType = formData.get('wordType') || '';
    
    // Validation
    if (!latinWord || !englishMeaning) {
        showMessage('Please fill in both Latin word and English meaning.', 'error');
        return;
    }
    
    if (latinWord.length < 2 || englishMeaning.length < 2) {
        showMessage('Words should be at least 2 characters long.', 'error');
        return;
    }
    
    // Check for duplicates
    const existingWords = getStoredWords();
    const isDuplicate = existingWords.some(word => 
        word.latin.toLowerCase() === latinWord.toLowerCase()
    );
    
    if (isDuplicate) {
        showMessage('This Latin word already exists in your vocabulary!', 'warning');
        return;
    }
    
    // Create word object
    const newWord = {
        id: generateUniqueId(),
        latin: latinWord.toLowerCase(),
        english: englishMeaning.toLowerCase(),
        type: wordType,
        dateAdded: new Date().toISOString(),
        lastStudied: null,
        timesStudied: 0,
        correctAnswers: 0,
        incorrectAnswers: 0,
        difficulty: 1, // Default difficulty
        nextReview: new Date().toISOString(), // Available immediately
        mastery: 0 // 0-100 scale
    };
    
    // Save the word
    if (saveWord(newWord)) {
        showMessage(`Successfully added "${latinWord}" to your vocabulary!`, 'success');
        form.reset();
        document.getElementById('latinWord').focus();
        
        // Update UI
        updateStats();
        loadRecentWords();
    } else {
        showMessage('Error saving word. Please try again.', 'error');
    }
}

function validateLatinInput(event) {
    const input = event.target;
    const value = input.value.trim();
    
    // Basic Latin character validation (allow letters, spaces, and common Latin punctuation)
    const latinPattern = /^[a-zA-ZÀ-ÿ\s\-']*$/;
    
    if (value && !latinPattern.test(value)) {
        input.style.borderColor = 'var(--warning-color)';
        showValidationMessage(input, 'Please use only Latin characters');
    } else {
        input.style.borderColor = 'var(--border-color)';
        hideValidationMessage(input);
    }
}

function validateEnglishInput(event) {
    const input = event.target;
    const value = input.value.trim();
    
    // Basic English validation
    const englishPattern = /^[a-zA-Z\s\-',\.]*$/;
    
    if (value && !englishPattern.test(value)) {
        input.style.borderColor = 'var(--warning-color)';
        showValidationMessage(input, 'Please use only English characters');
    } else {
        input.style.borderColor = 'var(--border-color)';
        hideValidationMessage(input);
    }
}

function showValidationMessage(input, message) {
    hideValidationMessage(input); // Remove any existing message
    
    const messageEl = document.createElement('small');
    messageEl.className = 'validation-error';
    messageEl.style.color = 'var(--warning-color)';
    messageEl.style.fontSize = '0.875rem';
    messageEl.style.marginTop = '0.25rem';
    messageEl.style.display = 'block';
    messageEl.textContent = message;
    
    input.parentNode.appendChild(messageEl);
}

function hideValidationMessage(input) {
    const existingMessage = input.parentNode.querySelector('.validation-error');
    if (existingMessage) {
        existingMessage.remove();
    }
}

function clearAddWordForm() {
    const form = document.getElementById('addWordForm');
    if (form) {
        form.reset();
        document.getElementById('latinWord').focus();
        
        // Clear any validation messages
        const validationMessages = form.querySelectorAll('.validation-error');
        validationMessages.forEach(msg => msg.remove());
        
        // Reset input border colors
        const inputs = form.querySelectorAll('.form-input');
        inputs.forEach(input => {
            input.style.borderColor = 'var(--border-color)';
        });
        
        showMessage('Form cleared!', 'info');
    }
}

function updateStats() {
    const words = getStoredWords();
    const today = new Date().toDateString();
    
    // Total words
    document.getElementById('totalWordsCount').textContent = words.length;
    
    // Words added today
    const todayWords = words.filter(word => 
        new Date(word.dateAdded).toDateString() === today
    );
    document.getElementById('recentlyAddedCount').textContent = todayWords.length;
    
    // Average mastery
    const avgMastery = words.length > 0 
        ? Math.round(words.reduce((sum, word) => sum + word.mastery, 0) / words.length)
        : 0;
    document.getElementById('averageScore').textContent = `${avgMastery}%`;
}

function loadRecentWords() {
    const recentWordsList = document.getElementById('recentWordsList');
    const words = getStoredWords();
    
    // Get last 5 words, sorted by date added (newest first)
    const recentWords = words
        .sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded))
        .slice(0, 5);
    
    if (recentWords.length === 0) {
        recentWordsList.innerHTML = `
            <p style="color: var(--text-secondary); text-align: center; padding: 2rem; font-style: italic;">
                No words added yet. Add your first Latin word above!
            </p>
        `;
        return;
    }
    
    const recentWordsHTML = recentWords.map(word => `
        <div style="
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 1rem; 
            margin-bottom: 0.5rem; 
            background: rgba(255, 255, 255, 0.05); 
            border-radius: 12px; 
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        " onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
            <div>
                <div style="font-weight: 600; color: var(--text-primary); font-size: 1.1rem; margin-bottom: 0.25rem;">
                    ${word.latin}
                </div>
                <div style="color: var(--text-secondary); font-size: 0.9rem;">
                    ${word.english}
                    ${word.type ? ` • ${word.type}` : ''}
                </div>
            </div>
            <div style="text-align: right; color: var(--text-secondary); font-size: 0.875rem;">
                ${formatDate(word.dateAdded)}
            </div>
        </div>
    `).join('');
    
    recentWordsList.innerHTML = recentWordsHTML;
}

// Utility Functions
function generateUniqueId() {
    return Date.now().toString(36) + Math.random().toString(36).substr(2);
}

function getStoredWords() {
    try {
        const stored = JSON.parse(localStorage.getItem('latinWords') || '[]');
        return Array.isArray(stored) ? stored : [];
    } catch (error) {
        console.error('Error loading stored words:', error);
        return [];
    }
}

function saveWord(word) {
    try {
        const existingWords = getStoredWords();
        existingWords.push(word);
        localStorage.setItem('latinWords', JSON.stringify(existingWords));
        return true;
    } catch (error) {
        console.error('Error saving word:', error);
        return false;
    }
}

function formatDate(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const diffTime = Math.abs(now - date);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays === 1) {
        return 'Today';
    } else if (diffDays === 2) {
        return 'Yesterday';
    } else if (diffDays <= 7) {
        return `${diffDays - 1} days ago`;
    } else {
        return date.toLocaleDateString();
    }
}

function showMessage(message, type = 'info') {
    const messageContainer = document.getElementById('messageContainer');
    if (!messageContainer) return;
    
    // Create message element
    const messageEl = document.createElement('div');
    messageEl.style.cssText = `
        padding: 1rem 1.5rem;
        margin-bottom: 0.5rem;
        border-radius: 12px;
        font-weight: 500;
        font-size: 0.95rem;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        animation: slideInRight 0.3s ease-out;
        max-width: 300px;
        word-wrap: break-word;
    `;
    
    // Set color based on type
    switch (type) {
        case 'success':
            messageEl.style.background = 'rgba(16, 185, 129, 0.9)';
            messageEl.style.color = 'white';
            break;
        case 'error':
            messageEl.style.background = 'rgba(239, 68, 68, 0.9)';
            messageEl.style.color = 'white';
            break;
        case 'warning':
            messageEl.style.background = 'rgba(245, 158, 11, 0.9)';
            messageEl.style.color = 'white';
            break;
        default:
            messageEl.style.background = 'rgba(99, 102, 241, 0.9)';
            messageEl.style.color = 'white';
    }
    
    messageEl.textContent = message;
    
    // Add animation styles
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
    
    messageContainer.appendChild(messageEl);
    
    // Auto-remove after 4 seconds
    setTimeout(() => {
        messageEl.style.animation = 'slideOutRight 0.3s ease-in';
        setTimeout(() => {
            if (messageEl.parentNode) {
                messageEl.parentNode.removeChild(messageEl);
            }
        }, 300);
    }, 4000);
    
    // Remove on click
    messageEl.addEventListener('click', () => {
        messageEl.style.animation = 'slideOutRight 0.3s ease-in';
        setTimeout(() => {
            if (messageEl.parentNode) {
                messageEl.parentNode.removeChild(messageEl);
            }
        }, 300);
    });
}

function initializeManageWords() {
    const contentArea = document.getElementById("contentArea");

    if (!contentArea) {
        console.error("Debug: #contentArea not found.");
        alert("Content area not found.");
        return;
    }

    let debugMessages = [];

    // Load words
    let storedWords = [];
    try {
        storedWords = JSON.parse(localStorage.getItem("latinWords")) || [];
        if (!Array.isArray(storedWords)) throw new Error("latinWords is not an array");
    } catch (err) {
        debugMessages.push(`⚠️ Failed to load words: ${err.message}`);
        storedWords = [];
    }

    // Build editable list
    const wordListHTML = storedWords.length
        ? storedWords.map((word, index) => `
            <div class="card" style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; margin-bottom: 1rem;">
                <div style="flex: 1; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <input type="text" value="${word.latin}" class="form-input" id="latin-${index}" style="font-weight: 600;" />
                    <input type="text" value="${word.english}" class="form-input" id="english-${index}" />
                </div>
                <div style="display: flex; gap: 0.5rem; margin-left: 1rem;">
                    <button class="btn" title="Save" data-save="${index}" style="padding: 0.5rem 0.75rem;">💾</button>
                    <button class="btn danger" title="Delete" data-index="${index}" style="padding: 0.5rem 0.75rem;">🗑️</button>
                </div>
            </div>
        `).join("")
        : `<p style="color: var(--text-secondary); text-align: center;">No words saved yet.</p>`;

    // Inject UI
    contentArea.innerHTML = `
        <div class="section active">
            <div class="section-header">
                <h2 class="section-title">Manage Saved Words</h2>
                <p style="color: var(--text-secondary); font-size: 1rem;">
                    Edit or delete saved vocabulary words
                </p>
            </div>

            <div class="stat-card" style="margin-bottom: 1rem;">
                <div class="stat-number">${storedWords.length}</div>
                <div class="stat-label">Total Words</div>
            </div>

            <div id="wordListContainer">
                ${wordListHTML}
            </div>

            ${storedWords.length > 0 ? `
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn danger" id="clearAllBtn">🗑️ Clear All Words</button>
                </div>` : ''
            }

            <div id="debugLog" style="margin-top: 2rem; font-size: 0.85rem; color: var(--warning-color); font-family: monospace;"></div>
        </div>
    `;

    // Delete handler
    document.querySelectorAll("[data-index]").forEach(btn => {
        btn.addEventListener("click", (e) => {
            const index = parseInt(e.target.dataset.index);
            storedWords.splice(index, 1);
            localStorage.setItem("latinWords", JSON.stringify(storedWords));
            initializeManageWords();
        });
    });

    // Save handler
    document.querySelectorAll("[data-save]").forEach(btn => {
        btn.addEventListener("click", (e) => {
            const index = parseInt(e.target.dataset.save);
            const latinInput = document.getElementById(`latin-${index}`);
            const englishInput = document.getElementById(`english-${index}`);
            const newLatin = latinInput.value.trim();
            const newEnglish = englishInput.value.trim();

            if (newLatin.length < 2 || newEnglish.length < 2) {
                alert("Words must be at least 2 characters.");
                return;
            }

            storedWords[index].latin = newLatin;
            storedWords[index].english = newEnglish;
            localStorage.setItem("latinWords", JSON.stringify(storedWords));
            showMessage("Word updated successfully.", "success");
        });
    });

    // Clear all handler
    const clearAllBtn = document.getElementById("clearAllBtn");
    if (clearAllBtn) {
        clearAllBtn.addEventListener("click", () => {
            if (confirm("Delete all words?")) {
                localStorage.removeItem("latinWords");
                initializeManageWords();
            }
        });
    }

    // Debug log
    const debugEl = document.getElementById("debugLog");
    if (debugEl && debugMessages.length > 0) {
        debugEl.innerHTML = `<strong>Debug Messages:</strong><br>${debugMessages.join("<br>")}`;
    }
}

function initializeStudy() {
    const contentArea = document.getElementById("contentArea");
    if (!contentArea) {
        alert("Content area not found.");
        return;
    }

    const allWords = getStoredWords();
    let wordsToStudy = getWordsForStudy(allWords);
    let currentIndex = 0;
    let correctCount = 0;
    let totalCount = 0;

    // Inject HTML
    contentArea.innerHTML = `
        <div class="section active">
            <div class="section-header">
                <h2 class="section-title">Study Quiz</h2>
                <p style="color: var(--text-secondary); font-size: 1rem;">
                    Practice your Latin vocabulary using smart review
                </p>
            </div>

            <div class="stats" style="margin-bottom: 2rem;">
                <div class="stat-card">
                    <div class="stat-number" id="studyTotal">${wordsToStudy.length}</div>
                    <div class="stat-label">Words to Study</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="studyCorrect">0</div>
                    <div class="stat-label">Correct</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="studyAccuracy">0%</div>
                    <div class="stat-label">Accuracy</div>
                </div>
            </div>

            <div class="card" style="max-width: 600px; margin: auto;">
                <div id="quizCard">
                    <!-- Quiz question will go here -->
                </div>
            </div>

            <div id="messageContainer" style="margin-top: 2rem;"></div>
        </div>
    `;

    showNextQuestion();

    function showNextQuestion() {
        if (currentIndex >= wordsToStudy.length) {
            document.getElementById("quizCard").innerHTML = `
                <h3 style="text-align: center;">🎉 You’ve completed your session!</h3>
                <p style="text-align: center; color: var(--text-secondary);">Well done! You can return home or study again.</p>
            `;
            return;
        }

        const word = wordsToStudy[currentIndex];
        document.getElementById("quizCard").innerHTML = `
            <h3 style="margin-bottom: 1rem;">Translate to English:</h3>
            <div style="font-size: 1.5rem; font-weight: 600; text-align: center; margin-bottom: 1rem;">
                ${word.latin}
            </div>
            <input type="text" id="answerInput" class="form-input" placeholder="Type the English meaning" autocomplete="off" />
            <button class="btn" id="submitAnswer" style="margin-top: 1rem;">Submit</button>
        `;

        document.getElementById("submitAnswer").addEventListener("click", () => {
            const userAnswer = document.getElementById("answerInput").value.trim().toLowerCase();
            totalCount++;

            if (userAnswer === word.english.toLowerCase()) {
                correctCount++;
                word.correctAnswers++;
                word.mastery = Math.min(100, word.mastery + 10);
                showMessage("✅ Correct!", "success");
            } else {
                word.incorrectAnswers++;
                word.mastery = Math.max(0, word.mastery - 10);
                showMessage(`❌ Incorrect. Correct answer: ${word.english}`, "error");
            }

            word.lastStudied = new Date().toISOString();
            word.timesStudied = (word.timesStudied || 0) + 1;
            word.nextReview = getNextReviewDate(word.mastery);
            saveAllWords(allWords);

            updateStats();
            currentIndex++;
            setTimeout(showNextQuestion, 1200);
        });

        document.getElementById("answerInput").focus();
    }

    function updateStats() {
        const accuracy = totalCount === 0 ? 0 : Math.round((correctCount / totalCount) * 100);
        document.getElementById("studyCorrect").textContent = correctCount;
        document.getElementById("studyAccuracy").textContent = `${accuracy}%`;
    }
}

function getStoredWords() {
    try {
        const stored = JSON.parse(localStorage.getItem('latinWords') || '[]');
        return Array.isArray(stored) ? stored : [];
    } catch (error) {
        console.error('Error reading words:', error);
        return [];
    }
}

function saveAllWords(words) {
    try {
        localStorage.setItem('latinWords', JSON.stringify(words));
    } catch (error) {
        console.error('Error saving words:', error);
    }
}

function getWordsForStudy(words) {
    const now = new Date();
    return words
        .filter(w => !w.nextReview || new Date(w.nextReview) <= now)
        .sort((a, b) => a.mastery - b.mastery)
        .slice(0, 20); // adjustable session length
}
function getNextReviewDate(mastery) {
    const now = new Date();
    const delayHours = Math.max(1, Math.round((100 - mastery) / 10)) * 6;
    return new Date(now.getTime() + delayHours * 60 * 60 * 1000).toISOString();
}

function showMessage(message, type = 'info') {
    const messageContainer = document.getElementById('messageContainer');
    if (!messageContainer) return;

    const msg = document.createElement('div');
    msg.style.cssText = `
        padding: 1rem 1.5rem;
        margin-bottom: 0.5rem;
        border-radius: 12px;
        font-weight: 500;
        font-size: 0.95rem;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        background: ${
            type === 'success' ? 'rgba(16, 185, 129, 0.9)' :
            type === 'error' ? 'rgba(239, 68, 68, 0.9)' :
            type === 'warning' ? 'rgba(245, 158, 11, 0.9)' :
            'rgba(99, 102, 241, 0.9)'
        };
        color: white;
        backdrop-filter: blur(10px);
        max-width: 300px;
        word-wrap: break-word;
    `;
    msg.textContent = message;
    messageContainer.appendChild(msg);

    setTimeout(() => msg.remove(), 3000);
}


        // Initialize the application
        window.onload = function() {
            // Load data manager first
            if (typeof loadAllData === 'function') {
                loadAllData();
            }
            
            // Initialize with home screen
            showHome();
        };
    </script>
</body>
</html>